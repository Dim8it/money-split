<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–†–æ–∑–ø–æ–¥—ñ–ª –≥—Ä–æ—à–µ–π</title>

<style>
:root {
    --bg: #1c1f24;
    --text: #e6e6e6;
    --table: #262a30;
    --head: #323843;
    --btn: #3fa96b;
    --btnh: #36945e;
    --hi: #ffd966;
    --danger: #d9534f;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: Arial, sans-serif;
    padding: 16px;
}

h2, h3 { margin-top: 20px; }

.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 12px;
}

.controls label {
    display: flex;
    gap: 6px;
    align-items: center;
}

input[type=number], input[type=date] {
    padding: 6px;
    border-radius: 4px;
    border: none;
}

button {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    background: var(--btn);
    color: #fff;
    cursor: pointer;
    box-shadow: 0 4px 0 rgba(0,0,0,.25);
}

button:active {
    transform: translateY(2px);
    box-shadow: 0 1px 0 rgba(0,0,0,.3);
}

.delete-btn {
    background: var(--danger);
    margin-left: 10px;
}

table {
    width: 100%;
    border-collapse: collapse;
    background: var(--table);
}

th, td {
    border: 1px solid #555;
    padding: 8px;
    text-align: center;
}

th { background: var(--head); }

.result {
    background: var(--hi);
    color: #000;
    font-weight: bold;
}

.paid {
    background: var(--btn) !important;
    color: #fff;
}

.history-card {
    background: #2e3440;
    margin: 10px 0;
    padding: 10px;
    border-left: 4px solid var(--btn);
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.history-info {
    cursor: pointer;
}

@media (max-width: 768px) {
    th:nth-child(2), td.coef { display: none; }
    button { width: 100%; }
    .controls { flex-direction: column; }
}
</style>
</head>

<body>

<h2>–†–æ–∑–ø–æ–¥—ñ–ª –≥—Ä–æ—à–µ–π</h2>

<div class="controls">
    <label>–î–∞—Ç–∞:
        <input type="date" id="payDate">
    </label>

    <label>–°—É–º–∞:
        <input type="number" id="totalSum">
    </label>

    <button onclick="calculate()">–ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
    <button onclick="saveDay()">–ó–±–µ—Ä–µ–≥—Ç–∏ –¥–µ–Ω—å</button>
</div>

<table>
<thead>
<tr>
<th>–Ü–º º—è</th>
<th>–ö–æ–µ—Ñ</th>
<th>–ü—Ä–∏—Å—É—Ç–Ω—ñ–π</th>
<th>–°—É–º–∞</th>
<th>‚úì</th>
</tr>
</thead>
<tbody>
<tr><td>–°–æ—Ñ—ñ—è</td><td class="coef">200</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–î—ñ–º–∞</td><td class="coef">110</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–Ø—Ä–∏–∫</td><td class="coef">110</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–î—ñ–∞–Ω–∞</td><td class="coef">110</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–ú–∞—Ä—É—Å—è</td><td class="coef">110</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–ê—Ä—ñ–Ω–∞</td><td class="coef">60</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–°–æ–ª—è</td><td class="coef">60</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–ú–∞—Ä—ñ—è</td><td class="coef">60</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–ó–°–£</td><td class="coef">100</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
<tr><td>–ì—É—Ä—Ç</td><td class="coef">80</td><td><input type="checkbox" checked></td><td class="result"></td><td><button onclick="markPaid(this)">‚úì</button></td></tr>
</tbody>
</table>

<h3>–Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–ø–ª–∞—Ç (–∫–ª—ñ–∫ ‚Äî —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è)</h3>
<div id="history"></div>

<script>
function calculate() {
    const total = +totalSum.value;
    if (!total) return alert("–í–≤–µ–¥–∏ —Å—É–º—É");

    const rows = document.querySelectorAll("tbody tr");
    let sumCoef = 0;

    rows.forEach(r => {
        if (r.querySelector("input").checked)
            sumCoef += +r.querySelector(".coef").textContent;
    });

    rows.forEach(r => {
        const cell = r.querySelector(".result");
        if (r.querySelector("input").checked) {
            cell.textContent = (total * r.querySelector(".coef").textContent / sumCoef).toFixed(2);
            cell.classList.remove("paid");
        } else cell.textContent = "";
    });
}

function markPaid(btn) {
    btn.closest("tr").querySelector(".result").classList.toggle("paid");
}

function saveDay() {
    const date = payDate.value;
    if (!date) return alert("–û–±–µ—Ä–∏ –¥–∞—Ç—É");

    const data = {};
    document.querySelectorAll("tbody tr").forEach(r => {
        const name = r.cells[0].textContent;
        const cell = r.querySelector(".result");
        if (cell.classList.contains("paid"))
            data[name] = cell.textContent;
    });

    const db = JSON.parse(localStorage.getItem("payments")) || {};
    db[date] = { total: totalSum.value, payouts: data };
    localStorage.setItem("payments", JSON.stringify(db));
    renderHistory();
}

function deleteDay(date) {
    if (!confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ –¥–∞—Ç—É ${date}?`)) return;
    const db = JSON.parse(localStorage.getItem("payments")) || {};
    delete db[date];
    localStorage.setItem("payments", JSON.stringify(db));
    renderHistory();
}

function renderHistory() {
    const db = JSON.parse(localStorage.getItem("payments")) || {};
    history.innerHTML = "";

    Object.keys(db).sort().reverse().forEach(d => {
        const div = document.createElement("div");
        div.className = "history-card";

        div.innerHTML = `
            <div class="history-info" onclick="loadDay('${d}')">
                <b>${d}</b> ‚Äî ${db[d].total} –≥—Ä–Ω
            </div>
            <button class="delete-btn" onclick="deleteDay('${d}')">üóë</button>
        `;

        history.appendChild(div);
    });
}

function loadDay(date) {
    const db = JSON.parse(localStorage.getItem("payments"));
    payDate.value = date;
    totalSum.value = db[date].total;

    document.querySelectorAll(".result").forEach(c => c.classList.remove("paid"));

    document.querySelectorAll("tbody tr").forEach(r => {
        const name = r.cells[0].textContent;
        if (db[date].payouts[name])
            r.querySelector(".result").classList.add("paid");
    });
}

renderHistory();
</script>

</body>
</html>
